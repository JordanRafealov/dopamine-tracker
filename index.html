<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dopamine Digital â€” Project Tracker</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg-root:#08080a;
  --bg-surface:#111114;
  --bg-card:#18181c;
  --bg-card-hover:#1e1e23;
  --bg-column:#0e0e11;
  --border:#222228;
  --border-subtle:#1a1a1f;
  --text-primary:#e8e6e3;
  --text-secondary:#8a8a8f;
  --text-muted:#555559;
  --accent:#d4a853;
  --accent-dim:#d4a85322;
  --accent-glow:#d4a85344;
  --cat-sop:#4a9eff;
  --cat-automation:#a855f7;
  --cat-kpi:#34d399;
  --cat-client:#f59e0b;
  --cat-project:#22d3ee;
  --priority-high:#ef4444;
  --priority-med:#eab308;
  --priority-low:#22c55e;
  --shadow-card:0 1px 3px rgba(0,0,0,.4),0 4px 12px rgba(0,0,0,.3);
  --shadow-drag:0 8px 32px rgba(0,0,0,.6),0 2px 8px rgba(0,0,0,.4);
  --radius:8px;
  --radius-sm:5px;
  --radius-lg:12px;
  --font-mono:'JetBrains Mono',monospace;
  --font-sans:'DM Sans',system-ui,sans-serif;
  --transition:180ms cubic-bezier(.4,0,.2,1);
}
html{font-size:14px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body{font-family:var(--font-sans);background:var(--bg-root);color:var(--text-primary);overflow-x:auto;min-height:100vh;display:flex;flex-direction:column}

/* HEADER */
.header{padding:20px 28px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#0c0c0f 0%,var(--bg-root) 100%);position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
.header-top{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
.brand{display:flex;align-items:baseline;gap:12px}
.brand h1{font-family:var(--font-mono);font-size:1.15rem;font-weight:700;letter-spacing:-.02em;color:var(--text-primary)}
.brand h1 span{color:var(--accent)}
.brand .tagline{font-size:.75rem;color:var(--text-muted);font-family:var(--font-mono);letter-spacing:.06em;text-transform:uppercase}
.header-actions{display:flex;align-items:center;gap:10px}
.search-box{background:var(--bg-surface);border:1px solid var(--border);border-radius:var(--radius);padding:7px 12px 7px 32px;color:var(--text-primary);font-family:var(--font-sans);font-size:.85rem;width:220px;outline:none;transition:border-color var(--transition);position:relative}
.search-box:focus{border-color:var(--accent)}
.search-wrap{position:relative}
.search-wrap::before{content:"";position:absolute;left:10px;top:50%;transform:translateY(-50%);width:14px;height:14px;border:2px solid var(--text-muted);border-radius:50%;pointer-events:none}
.search-wrap::after{content:"";position:absolute;left:22px;top:60%;width:5px;height:2px;background:var(--text-muted);transform:rotate(45deg);pointer-events:none}
.filter-row{display:flex;align-items:center;gap:8px;margin-top:12px;flex-wrap:wrap}
.filter-btn{background:var(--bg-surface);border:1px solid var(--border);border-radius:20px;padding:4px 14px;font-size:.75rem;color:var(--text-secondary);cursor:pointer;transition:all var(--transition);font-family:var(--font-sans)}
.filter-btn:hover{border-color:var(--text-muted);color:var(--text-primary)}
.filter-btn.active{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.filter-label{font-size:.7rem;color:var(--text-muted);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:.08em;margin-right:4px}
.filter-sep{width:1px;height:18px;background:var(--border);margin:0 6px}
.stats{display:flex;gap:16px;margin-left:auto}
.stat{font-family:var(--font-mono);font-size:.7rem;color:var(--text-muted);letter-spacing:.04em}
.stat strong{color:var(--accent);font-size:.85rem;margin-right:3px}

/* BOARD */
.board{display:flex;gap:12px;padding:16px 20px 24px;flex:1;overflow-x:auto;min-height:0;align-items:flex-start}
.board::-webkit-scrollbar{height:6px}
.board::-webkit-scrollbar-track{background:transparent}
.board::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.column{min-width:280px;max-width:320px;width:280px;flex-shrink:0;background:var(--bg-column);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);display:flex;flex-direction:column;max-height:calc(100vh - 160px);position:relative}
.column.drag-over{border-color:var(--accent);box-shadow:inset 0 0 0 1px var(--accent-dim)}
.column-header{padding:14px 16px 10px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border-subtle);position:sticky;top:0;background:var(--bg-column);border-radius:var(--radius-lg) var(--radius-lg) 0 0;z-index:2}
.column-title{font-family:var(--font-mono);font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.06em;color:var(--text-secondary)}
.column-count{font-family:var(--font-mono);font-size:.7rem;background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:1px 8px;color:var(--text-muted);min-width:24px;text-align:center}
.column-cards{flex:1;overflow-y:auto;padding:8px 8px 4px;display:flex;flex-direction:column;gap:6px;min-height:60px}
.column-cards::-webkit-scrollbar{width:4px}
.column-cards::-webkit-scrollbar-track{background:transparent}
.column-cards::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.column-footer{padding:6px 8px 8px}
.add-card-btn{width:100%;background:transparent;border:1px dashed var(--border);border-radius:var(--radius);padding:8px;color:var(--text-muted);font-size:.8rem;cursor:pointer;transition:all var(--transition);font-family:var(--font-sans);display:flex;align-items:center;justify-content:center;gap:6px}
.add-card-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}

/* CARDS */
.card{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius);padding:10px 12px;cursor:grab;transition:all var(--transition);position:relative;overflow:hidden}
.card::before{content:"";position:absolute;top:0;left:0;width:3px;height:100%;border-radius:3px 0 0 3px}
.card[data-cat="SOP"]::before{background:var(--cat-sop)}
.card[data-cat="Automation"]::before{background:var(--cat-automation)}
.card[data-cat="KPI"]::before{background:var(--cat-kpi)}
.card[data-cat="Client"]::before{background:var(--cat-client)}
.card[data-cat="Project"]::before{background:var(--cat-project)}
.card:hover{background:var(--bg-card-hover);border-color:var(--border);transform:translateY(-1px);box-shadow:var(--shadow-card)}
.card.dragging{opacity:.5;transform:rotate(1.5deg) scale(1.02);box-shadow:var(--shadow-drag);z-index:50}
.card.hidden{display:none}
.card-top{display:flex;align-items:flex-start;justify-content:space-between;gap:8px;margin-bottom:6px}
.card-title{font-size:.82rem;font-weight:600;line-height:1.35;color:var(--text-primary);flex:1}
.priority-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:3px;box-shadow:0 0 6px currentColor}
.priority-dot.high{background:var(--priority-high);color:var(--priority-high)}
.priority-dot.medium{background:var(--priority-med);color:var(--priority-med)}
.priority-dot.low{background:var(--priority-low);color:var(--priority-low)}
.card-meta{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.cat-tag{font-family:var(--font-mono);font-size:.6rem;letter-spacing:.04em;text-transform:uppercase;padding:2px 7px;border-radius:3px;font-weight:600}
.cat-tag.SOP{background:rgba(74,158,255,.12);color:var(--cat-sop)}
.cat-tag.Automation{background:rgba(168,85,247,.12);color:var(--cat-automation)}
.cat-tag.KPI{background:rgba(52,211,153,.12);color:var(--cat-kpi)}
.cat-tag.Client{background:rgba(245,158,11,.12);color:var(--cat-client)}
.cat-tag.Project{background:rgba(34,211,238,.12);color:var(--cat-project)}
.owner-badge{display:flex;align-items:center;gap:4px;font-size:.7rem;color:var(--text-muted)}
.owner-avatar{width:18px;height:18px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:.55rem;font-weight:700;color:var(--text-secondary)}
.card-due{font-family:var(--font-mono);font-size:.65rem;color:var(--text-muted);margin-left:auto}
.card-due.overdue{color:var(--priority-high)}
.card-due.soon{color:var(--priority-med)}
.card-desc{font-size:.75rem;color:var(--text-muted);line-height:1.45;margin-top:6px;display:none}
.card.expanded .card-desc{display:block}
.card-actions{display:none;position:absolute;top:6px;right:6px;gap:2px}
.card:hover .card-actions{display:flex}
.card-action-btn{background:var(--bg-surface);border:1px solid var(--border);border-radius:4px;width:22px;height:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-muted);font-size:.7rem;transition:all var(--transition)}
.card-action-btn:hover{color:var(--text-primary);border-color:var(--text-muted)}
.card-action-btn.delete:hover{color:var(--priority-high);border-color:var(--priority-high)}

/* DROP INDICATOR */
.drop-indicator{height:3px;background:var(--accent);border-radius:2px;margin:2px 0;opacity:0;transition:opacity 100ms}
.drop-indicator.visible{opacity:1}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:200;display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.open{display:flex}
.modal{background:var(--bg-surface);border:1px solid var(--border);border-radius:var(--radius-lg);width:100%;max-width:480px;padding:0;box-shadow:0 24px 80px rgba(0,0,0,.6);animation:modalIn 200ms ease-out}
@keyframes modalIn{from{opacity:0;transform:translateY(12px) scale(.98)}to{opacity:1;transform:none}}
.modal-header{padding:18px 22px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-header h2{font-family:var(--font-mono);font-size:.9rem;font-weight:600;text-transform:uppercase;letter-spacing:.04em}
.modal-close{background:none;border:none;color:var(--text-muted);font-size:1.2rem;cursor:pointer;padding:4px;line-height:1;transition:color var(--transition)}
.modal-close:hover{color:var(--text-primary)}
.modal-body{padding:18px 22px 22px}
.form-group{margin-bottom:14px}
.form-group label{display:block;font-family:var(--font-mono);font-size:.7rem;text-transform:uppercase;letter-spacing:.06em;color:var(--text-muted);margin-bottom:5px}
.form-group input,.form-group select,.form-group textarea{width:100%;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:8px 12px;color:var(--text-primary);font-family:var(--font-sans);font-size:.85rem;outline:none;transition:border-color var(--transition)}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--accent)}
.form-group textarea{resize:vertical;min-height:60px}
.form-group select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%238a8a8f' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:30px}
.form-row{display:flex;gap:10px}
.form-row .form-group{flex:1}
.form-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:18px}
.btn{padding:8px 18px;border-radius:var(--radius-sm);font-family:var(--font-sans);font-size:.82rem;font-weight:600;cursor:pointer;transition:all var(--transition);border:1px solid transparent}
.btn-primary{background:var(--accent);color:#0a0a0a;border-color:var(--accent)}
.btn-primary:hover{background:#e0b564;box-shadow:0 0 16px var(--accent-glow)}
.btn-ghost{background:transparent;color:var(--text-secondary);border-color:var(--border)}
.btn-ghost:hover{border-color:var(--text-muted);color:var(--text-primary)}
.btn-danger{background:transparent;color:var(--priority-high);border-color:rgba(239,68,68,.3)}
.btn-danger:hover{background:rgba(239,68,68,.1);border-color:var(--priority-high)}

/* CONFIRM */
.confirm-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:300;display:none;align-items:center;justify-content:center}
.confirm-overlay.open{display:flex}
.confirm-box{background:var(--bg-surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:22px;max-width:360px;text-align:center}
.confirm-box p{font-size:.9rem;margin-bottom:16px;color:var(--text-secondary)}
.confirm-box .form-actions{justify-content:center}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:10px 18px;font-size:.82rem;color:var(--text-primary);box-shadow:var(--shadow-drag);z-index:400;transform:translateY(100px);opacity:0;transition:all 300ms ease}
.toast.show{transform:translateY(0);opacity:1}

/* FOOTER */
.footer{padding:12px 28px;border-top:1px solid var(--border-subtle);text-align:center;font-family:var(--font-mono);font-size:.65rem;color:var(--text-muted);letter-spacing:.06em}

/* MOBILE */
@media(max-width:768px){
  .header{padding:14px 16px 12px}
  .brand h1{font-size:1rem}
  .brand .tagline{display:none}
  .search-box{width:160px}
  .board{padding:10px 12px 16px;gap:10px}
  .column{min-width:260px;width:260px}
  .stats{display:none}
  .filter-row{gap:5px}
}

/* COLUMN SPECIFIC ACCENTS */
.column[data-col="live"] .column-title{color:var(--priority-low)}
.column[data-col="live"] .column-count{border-color:rgba(34,197,94,.3);color:var(--priority-low)}
.column[data-col="in-progress"] .column-title{color:var(--cat-project)}
.column[data-col="this-week"] .column-title{color:var(--accent)}
</style>
</head>
<body>

<header class="header">
  <div class="header-top">
    <div class="brand">
      <h1>DOPAMINE DIGITAL <span>//</span> PROJECT TRACKER</h1>
      <span class="tagline">Operations Command</span>
    </div>
    <div class="header-actions">
      <div class="stats" id="stats"></div>
      <div class="search-wrap">
        <input type="text" class="search-box" id="searchInput" placeholder="Search cards...">
      </div>
    </div>
  </div>
  <div class="filter-row">
    <span class="filter-label">Category</span>
    <button class="filter-btn active" data-filter="category" data-value="all">All</button>
    <button class="filter-btn" data-filter="category" data-value="SOP">SOP</button>
    <button class="filter-btn" data-filter="category" data-value="Automation">Automation</button>
    <button class="filter-btn" data-filter="category" data-value="KPI">KPI</button>
    <button class="filter-btn" data-filter="category" data-value="Client">Client</button>
    <button class="filter-btn" data-filter="category" data-value="Project">Project</button>
    <div class="filter-sep"></div>
    <span class="filter-label">Owner</span>
    <button class="filter-btn active" data-filter="owner" data-value="all">All</button>
    <button class="filter-btn" data-filter="owner" data-value="Jordan">Jordan</button>
    <button class="filter-btn" data-filter="owner" data-value="Angela">Angela</button>
    <button class="filter-btn" data-filter="owner" data-value="Filip">Filip</button>
    <button class="filter-btn" data-filter="owner" data-value="Sophia">Sophia</button>
    <button class="filter-btn" data-filter="owner" data-value="Rodney">Rodney</button>
  </div>
</header>

<main class="board" id="board"></main>

<footer class="footer">DOPAMINE DIGITAL &copy; 2026 &mdash; BUILT BY CLAUDE CODE</footer>

<!-- CARD MODAL -->
<div class="modal-overlay" id="cardModal">
  <div class="modal">
    <div class="modal-header">
      <h2 id="modalTitle">Add Card</h2>
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Title</label>
        <input type="text" id="formTitle" placeholder="Card title...">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Category</label>
          <select id="formCategory">
            <option value="SOP">SOP</option>
            <option value="Automation">Automation</option>
            <option value="KPI">KPI</option>
            <option value="Client">Client</option>
            <option value="Project">Project</option>
          </select>
        </div>
        <div class="form-group">
          <label>Priority</label>
          <select id="formPriority">
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Owner</label>
          <select id="formOwner">
            <option value="Jordan">Jordan</option>
            <option value="Angela">Angela</option>
            <option value="Filip">Filip</option>
            <option value="Sophia">Sophia</option>
            <option value="Rodney">Rodney</option>
          </select>
        </div>
        <div class="form-group">
          <label>Due Date</label>
          <input type="date" id="formDue">
        </div>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="formDesc" placeholder="Brief description..."></textarea>
      </div>
      <input type="hidden" id="formColumn">
      <input type="hidden" id="formId">
      <div class="form-actions">
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-danger" id="deleteBtn" onclick="confirmDelete()" style="display:none">Delete</button>
        <button class="btn btn-primary" onclick="saveCard()">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- CONFIRM -->
<div class="confirm-overlay" id="confirmOverlay">
  <div class="confirm-box">
    <p>Delete this card? This cannot be undone.</p>
    <div class="form-actions">
      <button class="btn btn-ghost" onclick="closeConfirm()">Cancel</button>
      <button class="btn btn-danger" onclick="executeDelete()">Delete</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
const STORAGE_KEY = 'dd-kanban-v1';
const COLUMNS = [
  { id: 'backlog', title: 'Backlog' },
  { id: 'this-week', title: 'This Week' },
  { id: 'in-progress', title: 'In Progress' },
  { id: 'in-review', title: 'In Review' },
  { id: 'live', title: 'Live' }
];

const DEFAULT_DATA = {
  backlog: [
    {id:"b1",title:"Inbox Triage & Response Time SOP",category:"SOP",owner:"Jordan",priority:"high",description:"Sophia's 1-4 day response times killing leads. Target: <1 hour.",dueDate:"2026-02-04"},
    {id:"b2",title:"Lead Qualification Matrix SOP",category:"SOP",owner:"Jordan",priority:"high",description:"Remove 1-2 day wait for client confirmation on lead quality.",dueDate:"2026-02-04"},
    {id:"b3",title:"Email Response Playbook SOP",category:"SOP",owner:"Jordan",priority:"high",description:"Stop Sophia escalating every reply to Jordan/Angela.",dueDate:"2026-02-04"},
    {id:"b4",title:"Podcast Long-Form Editing SOP",category:"SOP",owner:"Jordan",priority:"high",description:"Rodney taking 1-2 hours per edit. Should be 15 min max.",dueDate:"2026-02-05"},
    {id:"b5",title:"Content Review & Approval SOP",category:"SOP",owner:"Jordan",priority:"medium",description:"Filip's 1-2 day feedback loop is a bottleneck.",dueDate:"2026-02-05"},
    {id:"b6",title:"Communication Standards SOP",category:"SOP",owner:"Jordan",priority:"medium",description:"Team using DMs/email instead of Slack channels."},
    {id:"b7",title:"Time Tracking & Reporting SOP",category:"SOP",owner:"Jordan",priority:"medium",description:"No task-level time visibility via Hubstaff."},
    {id:"b8",title:"Daily Shift Protocol SOP",category:"SOP",owner:"Jordan",priority:"medium",description:"Sophia has 2-hour login variance, 5-hour dead zones."},
    {id:"b9",title:"Video Editor Workflow SOP",category:"SOP",owner:"Jordan",priority:"low",description:"Rodney needs structured daily routine."},
    {id:"b10",title:"Inbox Priority Order SOP",category:"SOP",owner:"Jordan",priority:"medium",description:"Sophia doing wrong inboxes first."},
    {id:"b11",title:"Client Knowledge Onboarding SOP",category:"SOP",owner:"Jordan",priority:"medium",description:"Sophia doesn't know what clients sell."},
    {id:"b12",title:"Claude Project Setup SOP",category:"SOP",owner:"Angela",priority:"medium",description:"No AI context loaded for client projects."},
    {id:"b13",title:"Content Priority & Quality Tiers SOP",category:"SOP",owner:"Jordan",priority:"low",description:"Perfectionism on low-value content."},
    {id:"b14",title:"Content QA Checklist SOP",category:"SOP",owner:"Jordan",priority:"low",description:"Filip watching full videos during review."},
    {id:"b15",title:"Daily KPI Collector Workflow",category:"KPI",owner:"Angela",priority:"high",description:"n8n workflow: daily cron collects from ClickUp, Instantly, HeyReach, Slack."},
    {id:"b16",title:"Daily KPI Report Workflow",category:"KPI",owner:"Angela",priority:"high",description:"Posts daily KPI summary to #kpi-reports Slack channel."},
    {id:"b17",title:"Weekly KPI Report Workflow",category:"KPI",owner:"Angela",priority:"medium",description:"Monday cron: week-over-week trends and analysis."},
    {id:"b18",title:"Stale Lead Checker Workflow",category:"KPI",owner:"Angela",priority:"medium",description:"Every 4 hours: cross-ref ClickUp + Slack for stale leads."},
    {id:"b19",title:"Slack Daily Task Sync",category:"KPI",owner:"Angela",priority:"medium",description:"/starting my day command syncs ClickUp tasks to Slack."},
    {id:"b20",title:"Sophia Inbox Alert Workflow",category:"KPI",owner:"Angela",priority:"medium",description:"Every 30 min: check Instantly unread then Slack alert."},
    {id:"b21",title:"AI Social Media Content Generator",category:"Automation",owner:"Filip",priority:"low",description:"n8n template ready. Auto-generate social posts from content."},
    {id:"b22",title:"AI SDR Workflow",category:"Automation",owner:"Angela",priority:"medium",description:"AI lead qualification from n8n template library."},
    {id:"b23",title:"Content Repurposing Engine",category:"Automation",owner:"Filip",priority:"medium",description:"Podcast episodes to blog posts, clips, LinkedIn posts."},
    {id:"b24",title:"Short-Form Video Clip Generator",category:"Automation",owner:"Rodney",priority:"low",description:"Auto-generate short clips from long-form content."},
    {id:"b25",title:"Master Outbound SOP",category:"SOP",owner:"Jordan",priority:"high",description:"End-to-end outbound playbook: ICP, email, LinkedIn, podcast, reply handling."}
  ],
  'this-week': [
    {id:"tw1",title:"Ship Angela's AI Auto-Reply Bot",category:"Automation",owner:"Angela",priority:"high",description:"ODF getting most replies. AI qualification + auto-reply <60 seconds.",dueDate:"2026-02-03"},
    {id:"tw2",title:"Fix Lead Response Times",category:"Project",owner:"Jordan",priority:"high",description:"Implement AI auto-reply. Remove Sophia's schedule gap. Slack hot lead alerts.",dueDate:"2026-02-03"},
    {id:"tw3",title:"Send Accountability Structure to Team",category:"Project",owner:"Jordan",priority:"high",description:"Finalize doc, record Loom, schedule individual calls.",dueDate:"2026-02-05"},
    {id:"tw4",title:"Set Up KPI Tracking Dashboard",category:"KPI",owner:"Jordan",priority:"high",description:"Google Sheet or ClickUp dashboard. Per-member tracking.",dueDate:"2026-02-05"},
    {id:"tw5",title:"Clean Up ClickUp",category:"Project",owner:"Jordan",priority:"medium",description:"Remove inactive clients, add daily to-dos for team.",dueDate:"2026-02-05"}
  ],
  'in-progress': [
    {id:"ip1",title:"AI Auto-Reply Bot (ODF)",category:"Automation",owner:"Angela",priority:"high",description:"Using n8n + Claude. Auto-qualify and respond to outbound replies within 60 seconds."},
    {id:"ip2",title:"14-Day Operations Overhaul",category:"Project",owner:"Jordan",priority:"high",description:"19 SOPs across 4 tiers. Jan 29 - Feb 11 deadline. Hormozi 3Ds framework.",dueDate:"2026-02-11"},
    {id:"ip3",title:"Cooper OpenClaw Setup",category:"Project",owner:"Jordan",priority:"medium",description:"AI assistant on Mac Mini. Slack/Telegram integration. Daily backup cron. Morning messages."}
  ],
  'in-review': [],
  live: [
    {id:"l1",title:"YouTube Lead Response Automation",category:"Automation",owner:"Angela",priority:"high",description:"v1.1 LIVE. 36-node n8n workflow. TypeForm to AI qualification to ClickUp/ActiveCampaign/Slack. All 3 paths tested."},
    {id:"l2",title:"Hot Lead Escalation SOP",category:"SOP",owner:"Sophia",priority:"high",description:"Complete in Notion. Edge cases + manual leads + training reference."},
    {id:"l3",title:"General Client Podcast SOP",category:"SOP",owner:"Angela",priority:"medium",description:"Active in Notion. Covers guest research through post-production."},
    {id:"l4",title:"AI Cold Outreach Engine SOP",category:"SOP",owner:"Angela",priority:"medium",description:"Active in Notion. Instantly + HeyReach setup and management."},
    {id:"l5",title:"Discovery Call SOP",category:"SOP",owner:"Jordan",priority:"medium",description:"Active in Notion. Gap Selling framework for sales calls."}
  ]
};

// STATE
let state = loadState();
let activeFilters = { category: 'all', owner: 'all' };
let searchQuery = '';
let draggedCard = null;
let draggedFrom = null;
let editingId = null;
let deleteTarget = null;

function loadState() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) return JSON.parse(saved);
  } catch(e) {}
  return JSON.parse(JSON.stringify(DEFAULT_DATA));
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function genId() {
  return 'c' + Date.now().toString(36) + Math.random().toString(36).slice(2,6);
}

function getInitials(name) {
  return name.split(' ').map(w => w[0]).join('').toUpperCase().slice(0,2);
}

function formatDate(d) {
  if (!d) return '';
  const date = new Date(d + 'T00:00:00');
  const now = new Date();
  now.setHours(0,0,0,0);
  const diff = Math.floor((date - now) / 86400000);
  const month = date.toLocaleString('en', { month: 'short' });
  const day = date.getDate();
  return { text: `${month} ${day}`, overdue: diff < 0, soon: diff >= 0 && diff <= 2 };
}

function matchesFilter(card) {
  if (activeFilters.category !== 'all' && card.category !== activeFilters.category) return false;
  if (activeFilters.owner !== 'all' && card.owner !== activeFilters.owner) return false;
  if (searchQuery) {
    const q = searchQuery.toLowerCase();
    return card.title.toLowerCase().includes(q) || (card.description||'').toLowerCase().includes(q) || card.owner.toLowerCase().includes(q);
  }
  return true;
}

function renderBoard() {
  const board = document.getElementById('board');
  board.innerHTML = '';
  let totalCards = 0;
  let highCount = 0;

  COLUMNS.forEach(col => {
    const cards = state[col.id] || [];
    const visibleCards = cards.filter(matchesFilter);
    totalCards += cards.length;
    highCount += cards.filter(c => c.priority === 'high').length;

    const colEl = document.createElement('div');
    colEl.className = 'column';
    colEl.dataset.col = col.id;

    colEl.innerHTML = `
      <div class="column-header">
        <span class="column-title">${col.title}</span>
        <span class="column-count">${visibleCards.length}</span>
      </div>
      <div class="column-cards" data-column="${col.id}"></div>
      <div class="column-footer">
        <button class="add-card-btn" onclick="openAddModal('${col.id}')">+ Add card</button>
      </div>
    `;

    const cardsContainer = colEl.querySelector('.column-cards');

    cards.forEach(card => {
      const el = createCardElement(card, col.id);
      if (!matchesFilter(card)) el.classList.add('hidden');
      cardsContainer.appendChild(el);
    });

    // Drop zone events
    cardsContainer.addEventListener('dragover', handleDragOver);
    cardsContainer.addEventListener('dragenter', handleDragEnter);
    cardsContainer.addEventListener('dragleave', handleDragLeave);
    cardsContainer.addEventListener('drop', handleDrop);

    board.appendChild(colEl);
  });

  // Stats
  document.getElementById('stats').innerHTML = `
    <span class="stat"><strong>${totalCards}</strong>total</span>
    <span class="stat"><strong>${highCount}</strong>high priority</span>
  `;
}

function createCardElement(card, colId) {
  const el = document.createElement('div');
  el.className = 'card';
  el.dataset.id = card.id;
  el.dataset.cat = card.category;
  el.draggable = true;

  const due = formatDate(card.dueDate);
  const dueHtml = due.text ? `<span class="card-due ${due.overdue?'overdue':''}${due.soon?'soon':''}">${due.text}</span>` : '';

  el.innerHTML = `
    <div class="card-actions">
      <button class="card-action-btn" onclick="event.stopPropagation();openEditModal('${card.id}','${colId}')" title="Edit">&#9998;</button>
      <button class="card-action-btn delete" onclick="event.stopPropagation();confirmDeleteCard('${card.id}','${colId}')" title="Delete">&times;</button>
    </div>
    <div class="card-top">
      <span class="card-title">${card.title}</span>
      <span class="priority-dot ${card.priority}" title="${card.priority} priority"></span>
    </div>
    <div class="card-meta">
      <span class="cat-tag ${card.category}">${card.category}</span>
      <span class="owner-badge"><span class="owner-avatar">${getInitials(card.owner)}</span>${card.owner}</span>
      ${dueHtml}
    </div>
    ${card.description ? `<div class="card-desc">${card.description}</div>` : ''}
  `;

  // Click to expand
  el.addEventListener('click', (e) => {
    if (e.target.closest('.card-actions')) return;
    el.classList.toggle('expanded');
  });

  // Double click to edit
  el.addEventListener('dblclick', (e) => {
    e.preventDefault();
    openEditModal(card.id, colId);
  });

  // Drag events
  el.addEventListener('dragstart', (e) => {
    draggedCard = card;
    draggedFrom = colId;
    el.classList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', card.id);
    requestAnimationFrame(() => el.style.opacity = '0.4');
  });

  el.addEventListener('dragend', () => {
    el.classList.remove('dragging');
    el.style.opacity = '';
    draggedCard = null;
    draggedFrom = null;
    document.querySelectorAll('.drop-indicator').forEach(i => i.remove());
    document.querySelectorAll('.column.drag-over').forEach(c => c.classList.remove('drag-over'));
  });

  return el;
}

function handleDragEnter(e) {
  e.preventDefault();
  this.closest('.column').classList.add('drag-over');
}

function handleDragLeave(e) {
  if (!this.contains(e.relatedTarget)) {
    this.closest('.column').classList.remove('drag-over');
  }
}

function handleDragOver(e) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';

  const cards = [...this.querySelectorAll('.card:not(.dragging):not(.hidden)')];
  const afterCard = cards.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = e.clientY - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) return { offset, element: child };
    return closest;
  }, { offset: -Infinity }).element;

  // Remove old indicators
  this.querySelectorAll('.drop-indicator').forEach(i => i.remove());

  const indicator = document.createElement('div');
  indicator.className = 'drop-indicator visible';

  if (afterCard) {
    this.insertBefore(indicator, afterCard);
  } else {
    this.appendChild(indicator);
  }
}

function handleDrop(e) {
  e.preventDefault();
  const targetCol = this.dataset.column;

  this.querySelectorAll('.drop-indicator').forEach(i => i.remove());
  this.closest('.column').classList.remove('drag-over');

  if (!draggedCard || !draggedFrom) return;

  // Get position
  const cards = [...this.querySelectorAll('.card:not(.dragging):not(.hidden)')];
  const afterCard = cards.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = e.clientY - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) return { offset, id: child.dataset.id };
    return closest;
  }, { offset: -Infinity });

  // Remove from source
  state[draggedFrom] = state[draggedFrom].filter(c => c.id !== draggedCard.id);

  // Insert at position
  if (afterCard.id) {
    const idx = state[targetCol].findIndex(c => c.id === afterCard.id);
    state[targetCol].splice(idx, 0, draggedCard);
  } else {
    state[targetCol].push(draggedCard);
  }

  saveState();
  renderBoard();
  if (draggedFrom !== targetCol) showToast(`Moved to ${COLUMNS.find(c=>c.id===targetCol).title}`);
}

// MODAL
function openAddModal(colId) {
  editingId = null;
  document.getElementById('modalTitle').textContent = 'Add Card';
  document.getElementById('formTitle').value = '';
  document.getElementById('formCategory').value = 'SOP';
  document.getElementById('formPriority').value = 'medium';
  document.getElementById('formOwner').value = 'Jordan';
  document.getElementById('formDue').value = '';
  document.getElementById('formDesc').value = '';
  document.getElementById('formColumn').value = colId;
  document.getElementById('formId').value = '';
  document.getElementById('deleteBtn').style.display = 'none';
  document.getElementById('cardModal').classList.add('open');
  setTimeout(() => document.getElementById('formTitle').focus(), 100);
}

function openEditModal(cardId, colId) {
  let card;
  for (const col of COLUMNS) {
    card = state[col.id].find(c => c.id === cardId);
    if (card) { colId = col.id; break; }
  }
  if (!card) return;

  editingId = cardId;
  document.getElementById('modalTitle').textContent = 'Edit Card';
  document.getElementById('formTitle').value = card.title;
  document.getElementById('formCategory').value = card.category;
  document.getElementById('formPriority').value = card.priority;
  document.getElementById('formOwner').value = card.owner;
  document.getElementById('formDue').value = card.dueDate || '';
  document.getElementById('formDesc').value = card.description || '';
  document.getElementById('formColumn').value = colId;
  document.getElementById('formId').value = cardId;
  document.getElementById('deleteBtn').style.display = '';
  document.getElementById('cardModal').classList.add('open');
  setTimeout(() => document.getElementById('formTitle').focus(), 100);
}

function closeModal() {
  document.getElementById('cardModal').classList.remove('open');
  editingId = null;
}

function saveCard() {
  const title = document.getElementById('formTitle').value.trim();
  if (!title) { document.getElementById('formTitle').focus(); return; }

  const data = {
    id: editingId || genId(),
    title,
    category: document.getElementById('formCategory').value,
    priority: document.getElementById('formPriority').value,
    owner: document.getElementById('formOwner').value,
    dueDate: document.getElementById('formDue').value || undefined,
    description: document.getElementById('formDesc').value.trim() || undefined
  };

  const colId = document.getElementById('formColumn').value;

  if (editingId) {
    // Update in place
    for (const col of COLUMNS) {
      const idx = state[col.id].findIndex(c => c.id === editingId);
      if (idx !== -1) { state[col.id][idx] = data; break; }
    }
    showToast('Card updated');
  } else {
    state[colId].push(data);
    showToast('Card added');
  }

  saveState();
  renderBoard();
  closeModal();
}

function confirmDeleteCard(cardId, colId) {
  deleteTarget = { cardId, colId };
  document.getElementById('confirmOverlay').classList.add('open');
}

function confirmDelete() {
  if (editingId) {
    deleteTarget = { cardId: editingId };
    closeModal();
    document.getElementById('confirmOverlay').classList.add('open');
  }
}

function closeConfirm() {
  document.getElementById('confirmOverlay').classList.remove('open');
  deleteTarget = null;
}

function executeDelete() {
  if (!deleteTarget) return;
  for (const col of COLUMNS) {
    state[col.id] = state[col.id].filter(c => c.id !== deleteTarget.cardId);
  }
  saveState();
  renderBoard();
  closeConfirm();
  showToast('Card deleted');
}

// FILTERS
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const filterType = btn.dataset.filter;
    const value = btn.dataset.value;
    activeFilters[filterType] = value;

    document.querySelectorAll(`.filter-btn[data-filter="${filterType}"]`).forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderBoard();
  });
});

// SEARCH
document.getElementById('searchInput').addEventListener('input', (e) => {
  searchQuery = e.target.value;
  renderBoard();
});

// TOAST
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  clearTimeout(toast._timer);
  toast._timer = setTimeout(() => toast.classList.remove('show'), 2000);
}

// KEYBOARD
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeModal();
    closeConfirm();
  }
});

// Click outside modal
document.getElementById('cardModal').addEventListener('click', (e) => {
  if (e.target === e.currentTarget) closeModal();
});
document.getElementById('confirmOverlay').addEventListener('click', (e) => {
  if (e.target === e.currentTarget) closeConfirm();
});

// INIT
renderBoard();
</script>
</body>
</html>
